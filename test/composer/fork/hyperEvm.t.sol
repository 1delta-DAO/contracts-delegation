// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import {IERC20All} from "test/shared/interfaces/IERC20All.sol";
import {BaseTest} from "test/shared/BaseTest.sol";
import {Chains, Tokens, Lenders} from "test/data/LenderRegistry.sol";
import "test/composer/utils/CalldataLib.sol";
import {console} from "forge-std/console.sol";
import {ComposerPlugin, IComposerLike} from "plugins/ComposerPlugin.sol";

interface IA {
    function upgradeAndCall(address proxy, address implementation, bytes memory data) external;
}

contract ForkTestHyperEvm is BaseTest {
    IComposerLike oneDV2;

    // arb
    // address admin = 0x492d53456Cc219A755Ac5a2d8598fFd6F47A9fD1;
    // address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    // address proxy = 0x05f3f58716a88A52493Be45aA0871c55b3748f18;

    // op
    address admin = 0x36908C085E96782E67D4AEbFF6900E77da415570;
    address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    address proxy = 0xcB6Eb8df68153cebF60E1872273Ef52075a5C297;

    address mockSender = 0xbadA9c382165b31419F4CC0eDf0Fa84f80A3C8E5;
    // address mockSender = 0xdFF70A71618739f4b8C81B11254BcE855D02496B;

    uint256 internal constant forkBlock = 0;

    function setUp() public virtual {
        // initialize the chain
        string memory chainName = Chains.HYPEREVM;

        _init(chainName, forkBlock, true);

        oneDV2 = ComposerPlugin.getComposer(chainName);

        vm.prank(owner);
        IA(admin).upgradeAndCall(proxy, address(oneDV2), hex"");

        labelAddresses();
    }

    function labelAddresses() internal {
        vm.label(owner, "owner");
        vm.label(admin, "admin");
        vm.label(proxy, "proxy");
        vm.label(address(oneDV2), "Composer");
        vm.label(mockSender, "MeMeMeMe");
    }

    function test_fork_raw_hyperEvm() external {
        vm.prank(mockSender);
        address(proxy).call{value: 0.001e18}(getData());
    }

    function test_fork_params_hyperEvm() external {
        vm.prank(mockSender);
        (bytes memory params, uint256 value) = getParams2();
        IComposerLike(proxy).deltaCompose{value: value}(params);
    }

    // nonce 0n
    // cometCreditPermit.ts:120 expiry 1748970849
    // cometCreditPermit.ts:121 v,r,s 27n 0x8c2ebd619f0fef85520e275e95f372e76a6442b28cfe60b76547baca0decc64f 0x16eac8a7b9737f99696f09db674e26ce6e362eb4036153e70a5f9da3eece7aab
    // cometCreditPermit.ts:126 r 8c2ebd619f0fef85520e275e95f372e76a6442b28cfe60b76547baca0decc64f
    // cometCreditPermit.ts:127 vs 16eac8a7b9737f99696f09db674e26ce6e362eb4036153e70a5f9da3eece7aab

    function getData() internal pure returns (bytes memory d) {
        d =
            hex"17d730910000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000013610000000000000000000038d7ea4c680000000000000000000000000000000064b000000000000000000000000000000000000000001000000420000000000000000000000000000000000000679f4061bf049c5c6cac6bfe2415c2460815f4ac7fe00020001e6650000aa40c0c7644e0b2b224509571e10ad20d9c4ef2891ae002a960e63ccb0e5bde83a8c13e51e1cb91a00dc5ebab82ba76ccf5eab9c32aef228a1eb77a781000bb8000101000000ad11a8beb98bbf61dbb1aa0f6d6f2ecd87b35afa01b6c8d4bd055d3d3f535a39c20d4c7d60f3e55a96e410d276ce04b98458924ed16b8cf33b40a271e600000000010000aa40c0c7644e0b2b224509571e10ad20d9c4ef2891ae002a960e63ccb0e5bde83a8c13e51e1cb91a9601b6c8d4bd055d3d3f535a39c20d4c7d60f3e55a010000000200000000000000000000";
    }

    function getParams2() internal pure returns (bytes memory d, uint256 value) {
        value = 0.0e18;
        d =
            hex"4005555555555555555555555555555555555555555568e37de8d93d3496ae143f2e900490f6280c57cd6000555555555555555555555555555555555555555568e37de8d93d3496ae143f2e900490f6280c57cd0000000000000000016345785d8a00000abf0040015555555555555555555555555555555555555555fca1154c643c32638aee9a43eee7f377f515c801010000000000000000016345785d8a000020fca1154c643c32638aee9a43eee7f377f515c801000000000000000000000000000000000915400555555555555555555555555555555555555555556131b5fae19ea4f9d964eac0408e4408b66337b5206131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000008c4e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000005e000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000555555555555555555555555555555555555555500000000000000000000000094e8396e0869c9f2200760af0621afd240e1cf38000000000000000000000000cb6eb8df68153cebf60e1872273ef52075a5c2970000000000000000000000000000000000000000000000000000000068932a8a00000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004063407a490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec60000000000000000000000007066ddf85a4a624418af9da57e3f7baeefa8e792000000000000000000000000555555555555555555555555555555555555555500000000000000000000000094e8396e0869c9f2200760af0621afd240e1cf38000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000000001000276a40000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000001730a39b4900000000000000000161d9ec703d561e000000000000000000000000555555555555555555555555555555555555555500000000000000000000000094e8396e0869c9f2200760af0621afd240e1cf38000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000cb6eb8df68153cebf60e1872273ef52075a5c297000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000015e5010795b71690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000010000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec60000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002937b22536f75726365223a226e756c6c3a73746167696e672e3164656c74612e696f222c22416d6f756e74496e555344223a22332e373433323834353439363330343336222c22416d6f756e744f7574555344223a22332e37343436393137363238343930393134222c22526566657272616c223a22222c22466c616773223a302c22416d6f756e744f7574223a223939363030323736323937343338373439222c2254696d657374616d70223a313735343437333934362c22526f7574654944223a2236353966613061342d663736312d346533642d393330352d3664396238356565356437383a62626337303561382d313731352d343630352d613738382d643535323964353430313833222c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22616e5067704d7665724b3846356f3641765862584a3035514750396a326b6b33744746396559793836786546737a31344b7a514855647a55474677484b53444c4f4c42387a455642376d49576e664a6d6954574d70444d3262344a6c7233796f357158575150426d467a4d7278507848564156615152585747433064346658374a7356767a656857396e63674b4e425366774258345a4369302f633035476b496f4f4b6f57414139354d374852364f706d3750736a3150794d356e5759795172422b6e7450665a7747655372666a41344456574138754d74587577756a347235472b38445159306771763879723054715042363670743050777076646574534c7148484b535a31446e37797237693875554f742f4969313141464b52706a653270387869364c574554693137363966705a56495830446c41383767664537744a775a59744531662f724b574873394b4a6d2f585673413d3d227d7d00000000000000000000000000400594e8396e0869c9f2200760af0621afd240e1cf38c0fd3f8e8b0334077c9f342671be6f1a53001f12300003e794e8396e0869c9f2200760af0621afd240e1cf3800000000000000000000000000000000bada9c382165b31419f4cc0edf0fa84f80a3c8e5c0fd3f8e8b0334077c9f342671be6f1a53001f1250019ff84cb719e9f73b4c3d40a016414f7e8c099c1a00640000000000000000000000000000000000000000000000000235ed281559765f689332a6eda9b7745221bbf7137923d5dba742ecd79e722b08a3d70800459be8f5eabf81b310be132971fc67ae0efc84caf209d5ab952453fe9ebfef4085042eafe83f95300103e755555555555555555555555555555555555555550000000000000000016345785d8a0000cb6eb8df68153cebf60e1872273ef52075a5c29702c0fd3f8e8b0334077c9f342671be6f1a53001f12";
    }
}
