// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import {IERC20All} from "test/shared/interfaces/IERC20All.sol";
import {BaseTest} from "test/shared/BaseTest.sol";
import {Chains, Tokens, Lenders} from "test/data/LenderRegistry.sol";
import "test/composer/utils/CalldataLib.sol";
import {console} from "forge-std/console.sol";
import {ComposerPlugin, IComposerLike} from "plugins/ComposerPlugin.sol";

interface IA {
    function upgradeAndCall(address proxy, address implementation, bytes memory data) external;
}

contract CompoundV2ComposerLightTest is BaseTest {
    IComposerLike oneDV2;

    // arb
    // address admin = 0x492d53456Cc219A755Ac5a2d8598fFd6F47A9fD1;
    // address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    // address proxy = 0x05f3f58716a88A52493Be45aA0871c55b3748f18;

    // op
    address admin = 0x9ACC4fbBe3237e8f04173ECA2c5b19c277305f56;
    address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    address proxy = 0xCDef0A216fcEF809258aA4f341dB1A5aB296ea72;

    uint256 internal constant forkBlock = 0;

    function setUp() public virtual {
        // initialize the chain
        string memory chainName = Chains.OP_MAINNET;

        _init(chainName, forkBlock, true);

        oneDV2 = ComposerPlugin.getComposer(chainName);

        vm.prank(owner);
        IA(admin).upgradeAndCall(proxy, address(oneDV2), hex"");
    }

    function test_fork_raw() external {
        vm.prank(0x91ae002a960e63Ccb0E5bDE83A8C13E51e1cB91A);
        address(proxy).call(getData());
    }

    function test_fork_params() external {
        vm.prank(0x91ae002a960e63Ccb0E5bDE83A8C13E51e1cB91A);
        (bytes memory params, uint256 value) = getParams2();
        IComposerLike(proxy).deltaCompose{value: value}(params);
    }

    function getData() internal pure returns (bytes memory d) {
        d =
            hex"17d730910000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000098840054200000000000000000000000000000000000006ce95afbb8ea029495c66020883f87aae8864af9260004200000000000000000000000000000000000006ce95afbb8ea029495c66020883f87aae8864af92000000000000000000005af3107a400009220040014200000000000000000000000000000000000006fca11db2b5de60df9a2c81233333a449983b410101000000000000000000005af3107a400020fca11db2b5de60df9a2c81233333a449983b4101000000000000000000000000000000000715400542000000000000000000000000000000000000066131b5fae19ea4f9d964eac0408e4408b66337b5206131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000006c4e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000e801010000003d02000000478946bcd4a5a22b316470f5486fafb928c0ba25000000000000000000005af3107a40000100000000000000000000000000000000000000000a42000000000000000000000000000000000000060b2c639c533813f4aa9d7837caf62653d097ff85cdef0a216fcef809258aa4f341db1a5ab296ea72000000000000000000000000683d5bb2000000540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000003d3314f82e73edb06d29ff62c91ec8f5ff06571bdeb2900000000000000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000060000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff85000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000cdef0a216fcef809258aa4f341db1a5ab296ea7200000000000000000000000000000000000000000000000000005af3107a4000000000000000000000000000000000000000000000000000000000000003cd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000010000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec6000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000005af3107a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027f7b22536f75726365223a226e756c6c3a6c6f63616c686f7374222c22416d6f756e74496e555344223a22302e3235303635393335313938343938222c22416d6f756e744f7574555344223a22302e32353036303135343834383634393236222c22526566657272616c223a22222c22466c616773223a302c22416d6f756e744f7574223a22323530363733222c2254696d657374616d70223a313734383835303433342c22526f7574654944223a2231666466646536302d363531352d343235662d623166342d3231333039643730663630313a62616234636237362d353561642d343034392d626438372d643736333533333963343535222c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a224d62787973396d7371493667346b36374f42666c307165695a55567a4c7671332f38634c51586e456b626557574371484c6e6e74456630776c73734e706235374c576d72547244626c656133537133596c6b4443794c4e784e732b4e755332714a55743838777a4252375359344f694243735a4574384879313841326c476a62432b3555424e624f61586a4b4d6d5978527044344a334433743439343842756c6c395742466e43656e4d5262495839762f6377796e66696b374e516b704b68373457476d32576661664f6c46756d4b356e70512b554c7769676275674a744c51684163775667666f79754c586e4d544c55316b42486b436d683232514d516537477065734b444e6a7a7444344e6a384d484a517078536a694958474a506c752f63614e6a764342726846743064496e425950376e452f4a6e7a4d616d744c6859522f655a4b344a5a766a53436a4c68326a45465065413d3d227d7d0040050b2c639c533813f4aa9d7837caf62653d097ff85794a61358d6845594f94dc1db02a252b5b4814ad300203e70b2c639c533813f4aa9d7837caf62653d097ff850000000000000000000000000000000091ae002a960e63ccb0e5bde83a8c13e51e1cb91a025d557b07776d12967914379c71a1310e917c7555794a61358d6845594f94dc1db02a252b5b4814ad5000e50fa9b3c56ffb159cb0fca61f5c9d750e8128c8006400000000000000000000000000000000000000000000000000005af3107a4001683d5f204ead5e70ab595e58b5757f6ae7dbde6c2cfe5538743dad41fe08aef36ab1b027c70b81958b629f6c514138dee577c7debb59ccc54a90e775248c3f6084bb13d4300303e74200000000000000000000000000000000000006000000000000000000005af3107a4000ce95afbb8ea029495c66020883f87aae8864af92e50fa9b3c56ffb159cb0fca61f5c9d750e8128c8794a61358d6845594f94dc1db02a252b5b4814ad40010b2c639c533813f4aa9d7837caf62653d097ff8591ae002a960e63ccb0e5bde83a8c13e51e1cb91a0000000000000000000000000000000000000000000000000000000000000000000000000000000000";
    }

    function getParams2() internal pure returns (bytes memory d, uint256 value) {
        value = 0;
        d =
            hex"40057f5c764cbc14f9669b88837ca1490cca17c31607794a61358d6845594f94dc1db02a252b5b4814ad60007f5c764cbc14f9669b88837ca1490cca17c31607794a61358d6845594f94dc1db02a252b5b4814ad00000000000000000000000000030d40095f0040017f5c764cbc14f9669b88837ca1490cca17c31607fca11db2b5de60df9a2c81233333a449983b41010100000000000000000000000000030d4020fca11db2b5de60df9a2c81233333a449983b41010000000000000000000000000000000007b540057f5c764cbc14f9669b88837ca1490cca17c316076131b5fae19ea4f9d964eac0408e4408b66337b5206131b5fae19ea4f9d964eac0408e4408b66337b5000000000000000000000000000000000764e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000480000000000000000000000000000000000000000000000000000000000000017601020000003f000000c60cd02ab62b868a3451a9c028182d967ab9d00042000000000000000000000000000000000000060200000000000000000000000000030d40fd02731a000000870000009a13f98cb987694c9f086b1f5eb990eea8264ec301000000000022d473030f116ddee9f6b43ac78ba300000000000000000000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff850001f400000a000000000000000000000000000000000000000000000000000000000000000000000000000000010009046d02487f5c764cbc14f9669b88837ca1490cca17c316070b2c639c533813f4aa9d7837caf62653d097ff85cdef0a216fcef809258aa4f341db1a5ab296ea72000000000000000000000000683c69030000005400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000030f414f82e73edb06d29ff62c91ec8f5ff06571bdeb29000000000000000000000000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff85000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000cdef0a216fcef809258aa4f341db1a5ab296ea720000000000000000000000000000000000000000000000000000000000030d400000000000000000000000000000000000000000000000000000000000030ce70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000010000000000000000000000006e4141d33021b52c91c28608403db4a0ffb50ec600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000030d4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002837b22536f75726365223a226e756c6c3a6c6f63616c686f7374222c22416d6f756e74496e555344223a22302e3139393532373535303739383131383037222c22416d6f756e744f7574555344223a22302e3230303137303636313332393138383435222c22526566657272616c223a22222c22466c616773223a302c22416d6f756e744f7574223a22323030353133222c2254696d657374616d70223a313734383738383330372c22526f7574654944223a2237333637306637652d363237372d346432612d383963342d6232303763623731646534613a64333031636465642d366566332d346261372d613930332d626337663466613034623231222c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a2247744c615654377943555666624f56616f76595779564d58434f57306d58736b52567433384535395869304742744d2b674d424e2b31784e72677032446665304571744e386857646c726a6836335734435a525355784d54703374646f6d4d535344686b506e367655354535576866624f435a71714b497a39582b6e596a5042574758353141676978516e677a50675653343554616b36573466514563457a545967386a364f326c68794557336235323135676d39576666527530797073302b687834416949687165466a4537774e70656174324f4f392b4d794f7a793247545775364f6f336d4b317065583330655853543975484a684c6c345279455838463275494e4d2b5548544b32627a6169366a7674384270654c497a574767386f326d323777744e466b655a4c483161476675324c624a4d77624a53666e5152514a375739396c6b4c44536b65496b4a45587054535772773d3d227d7d000000000000000000000000000000000000000000000000000000000040050b2c639c533813f4aa9d7837caf62653d097ff85794a61358d6845594f94dc1db02a252b5b4814ad300003e70b2c639c533813f4aa9d7837caf62653d097ff850000000000000000000000000000000091ae002a960e63ccb0e5bde83a8c13e51e1cb91a794a61358d6845594f94dc1db02a252b5b4814ad5001fccf3cabbe80101232d343252614b6a3ee81c98900640000000000000000000000000000000000000000000000000000000000030d41683c6c584b25dffed99b10cd08c8d2962cfbb1d55c47c694fb6e005f5517acc1bbea5e183c1077d81353b55a75c01a01f349f9d3d9c337c40d7711af69e7ba9a4d0405a5300103e77f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000030d40cdef0a216fcef809258aa4f341db1a5ab296ea7202794a61358d6845594f94dc1db02a252b5b4814ad";
    }
}
