// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import {IERC20All} from "test/shared/interfaces/IERC20All.sol";
import {BaseTest} from "test/shared/BaseTest.sol";
import {Chains, Tokens, Lenders} from "test/data/LenderRegistry.sol";
import "contracts/utils/CalldataLib.sol";
import {console} from "forge-std/console.sol";
import {ComposerPlugin, IComposerLike} from "plugins/ComposerPlugin.sol";

interface IA {
    function upgradeAndCall(address proxy, address implementation, bytes memory data) external;
}

contract ForkTestHyperEvm is BaseTest {
    IComposerLike oneDV2;

    // arb
    // address admin = 0x492d53456Cc219A755Ac5a2d8598fFd6F47A9fD1;
    // address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    // address proxy = 0x05f3f58716a88A52493Be45aA0871c55b3748f18;

    // op
    address admin = 0x36908C085E96782E67D4AEbFF6900E77da415570;
    address owner = 0x999999833d965c275A2C102a4Ebf222ca938546f;
    address proxy = 0xcB6Eb8df68153cebF60E1872273Ef52075a5C297;

    address mockSender = 0xbadA9c382165b31419F4CC0eDf0Fa84f80A3C8E5;
    // address mockSender = 0xdFF70A71618739f4b8C81B11254BcE855D02496B;

    uint256 internal constant forkBlock = 0;

    function setUp() public virtual {
        // initialize the chain
        string memory chainName = Chains.HYPEREVM;

        _init(chainName, forkBlock, true);

        oneDV2 = ComposerPlugin.getComposer(chainName);

        vm.prank(owner);
        IA(admin).upgradeAndCall(proxy, address(oneDV2), hex"");

        labelAddresses();
    }

    function labelAddresses() internal {
        vm.label(owner, "owner");
        vm.label(admin, "admin");
        vm.label(proxy, "proxy");
        vm.label(address(oneDV2), "Composer");
        vm.label(mockSender, "MeMeMeMe");
    }

    function test_fork_raw_hyperEvm() external {
        vm.prank(mockSender);
        address(proxy).call{value: 0.001e18}(getData());
    }

    function test_fork_params_hyperEvm() external {
        vm.prank(mockSender);
        (bytes memory params, uint256 value) = getParams2();
        IComposerLike(proxy).deltaCompose{value: value}(params);
    }

    // nonce 0n
    // cometCreditPermit.ts:120 expiry 1748970849
    // cometCreditPermit.ts:121 v,r,s 27n 0x8c2ebd619f0fef85520e275e95f372e76a6442b28cfe60b76547baca0decc64f 0x16eac8a7b9737f99696f09db674e26ce6e362eb4036153e70a5f9da3eece7aab
    // cometCreditPermit.ts:126 r 8c2ebd619f0fef85520e275e95f372e76a6442b28cfe60b76547baca0decc64f
    // cometCreditPermit.ts:127 vs 16eac8a7b9737f99696f09db674e26ce6e362eb4036153e70a5f9da3eece7aab

    function getData() internal pure returns (bytes memory d) {
        d =
            hex"17d730910000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000013610000000000000000000038d7ea4c680000000000000000000000000000000064b000000000000000000000000000000000000000001000000420000000000000000000000000000000000000679f4061bf049c5c6cac6bfe2415c2460815f4ac7fe00020001e6650000aa40c0c7644e0b2b224509571e10ad20d9c4ef2891ae002a960e63ccb0e5bde83a8c13e51e1cb91a00dc5ebab82ba76ccf5eab9c32aef228a1eb77a781000bb8000101000000ad11a8beb98bbf61dbb1aa0f6d6f2ecd87b35afa01b6c8d4bd055d3d3f535a39c20d4c7d60f3e55a96e410d276ce04b98458924ed16b8cf33b40a271e600000000010000aa40c0c7644e0b2b224509571e10ad20d9c4ef2891ae002a960e63ccb0e5bde83a8c13e51e1cb91a9601b6c8d4bd055d3d3f535a39c20d4c7d60f3e55a010000000200000000000000000000";
    }

    function getParams2() internal pure returns (bytes memory d, uint256 value) {
        value = 0.0e18;
        d =
            hex"4005555555555555555555555555555555555555555568e37de8d93d3496ae143f2e900490f6280c57cd6000555555555555555555555555555555555555555568e37de8d93d3496ae143f2e900490f6280c57cd000000000000000001c203dff868c00010740040015555555555555555555555555555555555555555fca11b85ac641f1ba215259566d579a45519e506000000000000000000000000000000000020fca11b85ac641f1ba215259566d579a45519e506000000000000000000000000000000001011400555555555555555555555555555555555555555556131b5fae19ea4f9d964eac0408e4408b66337b5206131b5fae19ea4f9d964eac0408e4408b66337b5000000000000000000000000000000000e04e21fd0e9000000000000000000000000000000000000000000000000000000000000002000000000000000000000000063242a4ea82847b20e506b63b0e2e2eff0cc6cb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000b400000000000000000000000000000000000000000000000000000000000000840000000000000000001c203dff868c000000000000000000001c203dff868c000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000041d90441fdb589440ba27fff068596f91565c7b35c34a4fa2574eb695af2fbcf72033837c098081ff6373b907bc00f01d09197be7d19a4ced2f8c758930b6088e71b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000740000000000000000000000000fca11b85ac641f1ba215259566d579a45519e50600000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000180000000000000000001ab83ae5f305000000000000000000001d8841191a13000000000000000000001c203dff868c00000000000000000002f9d53ef36fdd2000000000000000000000000000000000000031ed6fc8e9b0000000f42400000000000000000000000000000004f82e73edb06d29ff62c91ec8f5ff06571bdeb29000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000029e8d608000000000000000000000000000000000000000000000000000000000000000720000000000000000000000000000000000000000000000000000000000000000161f598cd0000000000000000f5e7837708e279c36073ea6fbd205746bc0a2a2b00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003800000000000000000000000000000000000000000000000000000000000000500000000000000000000000000555555555555555555555555555555555555555580000000000000000000001d7e004b00000000000000000001c203dff868c00000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000001c203dff868c0003b9d6e0900000000000000015455c918e405a2831fbff8595c0aae35ee3db9d1000000000000000000000000000000000000000000000000000000000000008000000000000000000000000063242a4ea82847b20e506b63b0e2e2eff0cc6cb00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000705d5dda03d170384eb43eb1aa692a6fc548306f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fd739d4e423301ce9385c1fb8850539d657c296d80000000000000000000001d4c4ae20c000000000000000001bf0d619fb4ab0000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000001bf0d619fb4ab006efd106f00000000000000020c3b706efa1da39450c968e669fdc442fc375021000000000000000000000000000000000000000000000000000000000000008000000000000000000000000063242a4ea82847b20e506b63b0e2e2eff0cc6cb000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005e43a757ba769d4cd5fe568ae2429d4ae69e0ecf000000000000000000000000ff53611968f1e5ca45cfca7918447e7f5776f6d4000000000000000000000000b8ce59fc3717ada4c02eadf9682a9e934f625ebb8000000000000000000000000000000300000000000000000000000000350f7f0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000350f7f3b9d6e0900000000000000035455c918e405a2831fbff8595c0aae35ee3db9d1000000000000000000000000000000000000000000000000000000000000008000000000000000000000000063242a4ea82847b20e506b63b0e2e2eff0cc6cb0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000044a59f7859f199768e585133e0a5ab2da1350600000000000000000000000000000000000000000000001260998ba292cc078d6300000000000000000000000002c6a2fa58cc01a18b8d9e00ea48d65e4df26c708000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555555555555555555555555555555555555555500000000000000000000000002c6a2fa58cc01a18b8d9e00ea48d65e4df26c70000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000fca11b85ac641f1ba215259566d579a45519e50600000000000000000000000000000000000000000000000001c203dff868c0000000000000000000000000000000000000000000000000002f6c92100cc99ae200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000100000000000000000000000063242a4ea82847b20e506b63b0e2e2eff0cc6cb0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000001c203dff868c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002807b22536f75726365223a22222c22416d6f756e74496e555344223a22332e34373738393534383133303530393935222c22416d6f756e744f7574555344223a22332e34373534383631373438323436323935222c22526566657272616c223a22222c22466c616773223a302c22416d6f756e744f7574223a2233343330393930373738303131303739313637222c2254696d657374616d70223a313736353832333039352c22526f7574654944223a2239353262363866372d613638622d343965342d613335312d6433393463633936303134353a34633761386361352d653135372d346536332d623133392d303466373530366262626663222c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a225750665469457455615630416e5874795145395567695643476979654d786978735858386d7276563845557a6e6c75556564704864632f614d33615a6e553857596e54634f733246476336466966414b484d584a5068504e4971544d5558354674456c4b6259764665366c646f386258464e6b6939314d4f56564b614a665551784a76623445692b36544652433074474f667662792f4b56345a43542b7764343248786a6c4e47384365596c737a756b2f646a6738354a5543396a7747586431586850777661582f5645416a4664734b4155664a475a386170366970723531794458452f334462624b3144713256505850784245495a53705866513139666e457242335a554f306a744f3153354d64695a4469394356486d62372f7954496a7775526a31345869646e58344d4a6e433479735a545a79397662625147314d49566f6b784d2f384d6735532b70736a62386b61564938413d3d227d7d400502c6a2fa58cc01a18b8d9e00ea48d65e4df26c70c0fd3f8e8b0334077c9f342671be6f1a53001f1222c0fd3f8e8b0334077c9f342671be6f1a53001f120000000000000000000000000000000002c6a2fa58cc01a18b8d9e00ea48d65e4df26c70006000a400a718a9000000000000000000000000555555555555555555555555555555555555555500000000000000000000000002c6a2fa58cc01a18b8d9e00ea48d65e4df26c70000000000000000000000000eb74a1e540e9492d175c696fb4c71ba864b0570a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040015555555555555555555555555555555555555555cb6eb8df68153cebf60e1872273ef52075a5c29701000000000000000001c203dff868c00040015555555555555555555555555555555555555555777777f7447c10c1360926d282ff218100ca279a0000000000000000000000000000000000400102c6a2fa58cc01a18b8d9e00ea48d65e4df26c70777777f7447c10c1360926d282ff218100ca279a000000000000000000000000000000000040015555555555555555555555555555555555555555777777f7447c10c1360926d282ff218100ca279a0000000000000000000000000000000000400102c6a2fa58cc01a18b8d9e00ea48d65e4df26c70777777f7447c10c1360926d282ff218100ca279a0000000000000000000000000000000000";
    }
}
