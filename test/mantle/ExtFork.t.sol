// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import "./DeltaSetup.f.sol";

contract InitForkTestMantle is DeltaSetup {
    address user = 0x21885e45d0773A2C48A8BE32E6cA2CdB3e64cC26;
    address initProxy = 0xc08BFef7E778f3519D79E96780b77066F5d4FCC0;

    function setUp() public override {
        vm.createSelectFork({blockNumber: 76_288_600, urlOrAlias: "https://rpc.mantle.xyz"});
        address admin = 0x999999833d965c275A2C102a4Ebf222ca938546f;
        address proxy = 0x9bc92bF848FaF2355c429c54d1edE3e767bDd790;
        address oldModule = 0x4661D9f5b672e6968aE44eec1277d596e37B5F45;
        upgradeExistingDelta(proxy, admin, oldModule);
    }

    function test_init_fork() external {
        vm.prank(user);
        (bool success, bytes memory ret) = address(initProxy).call(getCalldata());
        if (!success) {
            // Next 5 lines from https://ethereum.stackexchange.com/a/83577
            if (ret.length < 68) {
                console.logBytes(ret);
                // revert("unexpected error");
            }
            assembly {
                ret := add(ret, 0x04)
            }
            console.log(abi.decode(ret, (string)));
        }
    }

    function getCalldata() internal pure returns (bytes memory data) {
        data =
            hex"ac9650d8000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000000c48229e25f000000000000000000000000e6829d9a7ee3040e1276fa75293bde931859e8fa0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000a8e5613379a3d267c124c90000000067c124c9de71fb7773a5e689d5159fe79cdcb095baaf7854584bd3b10f43b33ab2768ed3f960110a1cd4d4f62eb32c857d0d6875b444b9621a8331fa6000445adb15bfb60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000446377aac4000000000000000000000000e6829d9a7ee3040e1276fa75293bde931859e8fa00000000000000000000000000000000000000000000000000a8e5613379a3d200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004447e7ef24000000000000000000000000e6829d9a7ee3040e1276fa75293bde931859e8faceced809227c80b2c9170832ceb16f26127ecdd51a8bfeb29196d19bd72c76dc00000000000000000000000000000000000000000000000000000000";
    }
}
